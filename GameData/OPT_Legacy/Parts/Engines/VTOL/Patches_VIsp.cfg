@PART[opt_vtol_wrap?2]:NEEDS[B9PartSwitch]
{
	@description ^= :$: <br><color="green">This part can exchange thrust for Isp.</color>
	
	VIspThrustVac4K = #$VIspThrustVac3K$
	@VIspThrustVac4K *= 0.833
	VIspThrustVac5K = #$VIspThrustVac3K$
	@VIspThrustVac5K *= 0.667
	VIspThrustVac6K = #$VIspThrustVac3K$
	@VIspThrustVac6K *= 0.5
	
	VIspThrustASL3K = #$VIspThrustVac3K$
	@VIspThrustASL3K *= 0.01
	VIspThrustASL4K = #$VIspThrustVac4K$
	@VIspThrustASL4K *= 0.01
	VIspThrustASL5K = #$VIspThrustVac5K$
	@VIspThrustASL5K *= 0.01
	VIspThrustASL6K = #$VIspThrustVac6K$
	@VIspThrustASL6K *= 0.01
	
	MODULE
	{
		name = ModuleB9PartSwitch
		moduleID = DynoTune
		switcherDescription = VIsp Step
		switcherDescriptionPlural = Variable Isp Steps
		switchInFlight = True
		SUBTYPE
		{
			name = 3K
			title = 3K
			primaryColor = Dark
			secondaryColor = NeonPurple // DarkSeafoam
			defaultSubtypePriority = 4
			descriptionSummary = 3000s Vac Isp (Default)
			descriptionDetail = <b>Thrust:</b> 4.5 kN ASL / <color="yellow">450 kN</color> Vac.<br><b>Isp:</b> 30 s ASL / <color="yellow">3000 s</color> Vac.<br><b>Requires:</b> <color="yellow">311.81 EC/s</color> at full throttle.<br><color="orange">When in flight, shutdown engine before switching.</color>
			
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleEnginesFX
					engineID = WJClosed
				}
				DATA
				{
					maxThrust = #$../../../../VIspThrustVac3K$
					PROPELLANT
					{
						name = ElectricCharge
						ratio = 101.927
						DrawGauge = True
					}
					PROPELLANT
					{
						name = IntakeAir
						ratio = 1
						DrawGauge = True
					}
					atmosphereCurve
					{
						key = 0.001 3000
						key = 1 30
						key = 1.05 0.001 0 0
					}
				}
			}
		}
		SUBTYPE
		{
			name = 4K
			title = 4K
			primaryColor = Dark
			secondaryColor = NeonPurple // DarkLime
			upgradeRequired = OPTVIsp
			defaultSubtypePriority = 1
			descriptionSummary = 4000s Vac Isp
			descriptionDetail = <b>Thrust:</b> 3.749 kN ASL / <color="yellow">374.85 kN</color> Vac.<br><b>Isp:</b> 40 s ASL / <color="yellow">4000 s</color> Vac.<br><b>Requires:</b> <color="yellow">311.81 EC/s</color> at full throttle.<br><color="orange">When in flight, shutdown engine before switching.</color>
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleEnginesFX
					engineID = WJClosed
				}
				DATA
				{
					maxThrust = #$../../../../VIspThrustVac4K$
					PROPELLANT
					{
						name = ElectricCharge
						ratio = 162.675
						DrawGauge = True
					}
					PROPELLANT
					{
						name = IntakeAir
						ratio = 1
						DrawGauge = True
					}
					atmosphereCurve
					{
						key = 0.001 4000
						key = 1 40
						key = 1.05 0.001 0 0
					}
				}
			}
		}
		SUBTYPE
		{
			name = 5K
			title = 5K
			primaryColor = Dark
			secondaryColor = NeonPurple // DarkMustard
			upgradeRequired = OPTVIsp
			defaultSubtypePriority = 2
			descriptionSummary = 5000s Vac Isp
			descriptionDetail = <b>Thrust:</b> 3 kN ASL / <color="yellow">300.15 kN</color> Vac.<br><b>Isp:</b> 50 s ASL / <color="yellow">5000 s</color> Vac.<br><b>Requires:</b> <color="yellow">311.81 EC/s</color> at full throttle.<br><color="orange">When in flight, shutdown engine before switching.</color>
			
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleEnginesFX
					engineID = WJClosed
				}
				DATA
				{
					maxThrust = #$../../../../VIspThrustVac5K$
					PROPELLANT
					{
						name = ElectricCharge
						ratio = 254.867
						DrawGauge = True
					}
					PROPELLANT
					{
						name = IntakeAir
						ratio = 1
						DrawGauge = True
					}
					atmosphereCurve
					{
						key = 0.001 5000
						key = 1 50
						key = 1.05 0.001 0 0
					}
				}
			}
		}
		SUBTYPE
		{
			name = 6K
			title = 6K
			primaryColor = Dark
			secondaryColor = NeonPurple // DarkPeach
			upgradeRequired = OPTVIsp
			defaultSubtypePriority = 3
			descriptionSummary = 6000s Vac Isp
			descriptionDetail = <b>Thrust:</b> 2.25 kN ASL / <color="yellow">225 kN</color> Vac.<br><b>Isp:</b> 30 s ASL / <color="yellow">3000 s</color> Vac.<br><b>Requires:</b> <color="yellow">311.81 EC/s</color> at full throttle.<br><color="orange">When in flight, shutdown engine before switching.</color>
			MODULE
			{
				IDENTIFIER
				{
					name = ModuleEnginesFX
					engineID = WJClosed
				}
				DATA
				{
					maxThrust = #$../../../../VIspThrustVac6K$
					PROPELLANT
					{
						name = ElectricCharge
						ratio = 407.710
						DrawGauge = True
					}
					PROPELLANT
					{
						name = IntakeAir
						ratio = 1
						DrawGauge = True
					}
					atmosphereCurve
					{
						key = 0.001 6000
						key = 1 60
						key = 1.05 0.001 0 0
					}
				}
			}
		}
	}
}

@PART[opt_vtol_wrapk2|opt_vtol_wrapl2]:NEEDS[B9PartSwitch]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[DynoTune]]
	{
		@SUBTYPE[3K]
		{
			@descriptionDetail = <b>Thrust:</b> 6.75 kN ASL / <color="yellow">675 kN</color> Vac.<br><b>Isp:</b> 30 s ASL / <color="yellow">3000 s</color> Vac.<br><b>Requires:</b> <color="yellow">467.72 EC/s</color> at full throttle.<br><color="orange">When in flight, shutdown engine before switching.</color>
		}
		@SUBTYPE[4K]
		{
			@descriptionDetail = <b>Thrust:</b> 5.62 kN ASL / <color="yellow">562.28 kN</color> Vac.<br><b>Isp:</b> 40 s ASL / <color="yellow">4000 s</color> Vac.<br><b>Requires:</b> <color="yellow">467.72 EC/s</color> at full throttle.<br><color="orange">When in flight, shutdown engine before switching.</color>
		}
		@SUBTYPE[5K]
		{
			@descriptionDetail = <b>Thrust:</b> 4.5 kN ASL / <color="yellow">450.23 kN</color> Vac.<br><b>Isp:</b> 50 s ASL / <color="yellow">5000 s</color> Vac.<br><b>Requires:</b> <color="yellow">467.72 EC/s</color> at full throttle.<br><color="orange">When in flight, shutdown engine before switching.</color>
		}
		@SUBTYPE[6K]
		{
			@descriptionDetail = <b>Thrust:</b> 3.38 kN ASL / <color="yellow">337.5 kN</color> Vac.<br><b>Isp:</b> 60 s ASL / <color="yellow">6000 s</color> Vac.<br><b>Requires:</b> <color="yellow">467.72 EC/s</color> at full throttle.<br><color="orange">When in flight, shutdown engine before switching.</color>
		}
		
	}
}