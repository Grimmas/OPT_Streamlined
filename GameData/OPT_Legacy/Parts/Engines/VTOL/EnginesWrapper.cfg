PART
{
	name = opt_vtol_wrapj1
	module = Part
	author = JadeOfMaar
	MODEL
	{
		model = OPT_Legacy/Parts/Engines/VTOL/J
	}
	rescaleFactor = 1
	node_attach = 0.0, 2.5, 0.0, 0.0, -1.0, 0.0
	TechRequired = aerospaceTech
	entryCost = 26000
	cost = 11400
	category = Engine
	subcategory = 0
	title = OPT-E FVT-J
	manufacturer = OPT Propulsion Science Division
	description = This powerful accessory, the Fuselage Vertical Thruster hooks on at the sides of the fuselage and includes working intake and exhaust shutters to protect its innards from the fires of reentry. Be careful not to fire this engine while the exhaust shutter is closed!
	tags = opt jet lift vertical vtol eng thrust
	// mirrorRefAxis = 0, 0, -1
	attachRules = 0,1,0,0,0

	mass = 4
	dragModelType = default
	maximum_drag = 0.2
	minimum_drag = 0.2
	angularDrag = 2
	bulkheadProfiles = j,srf
	crashTolerance = 12
	breakingForce = 400
	breakingTorque = 600
	maxTemp = 1800
	skinMaxTemp = 2700
	emissiveConstant = 1.4 // engine nozzles are good at radiating.
	EFFECTS
	{
		engage
		{
			AUDIO
			{
				name = engageengine
				channel = Ship
				clip = sound_vent_soft
				volume = 0.2
				pitch = 0.4
				loop = false
			}
		}
		disengage
		{
			AUDIO
			{
				channel = Ship
				clip = sound_vent_soft
				volume = 0.1
				pitch = 0.6
				loop = false
				speed = 1 0.2
			}
		}
		flameout
		{
			AUDIO
			{
				channel = Ship
				clip = sound_explosion_low
				volume = 0.3
				pitch = 2.0
				loop = false
			}
		}
		running_open
		{
			// PREFAB_PARTICLE
			// {
				// name = smokethrustrocket
				// prefabName = fx_smokeTrail_light
				// transformName = thrustTransform
				// emission = 0.0 0.0
				// emission = 0.05 0.0
				// emission = 0.075 0.25
				// emission = 1.0 0.5
				// emission = 1.7 1
				// speed = 0.0 0.25
				// speed = 1.0 1.0
				// localOffset = 0,0,1
				// localRotation = 1,0,0,-90
			// }
			MODEL_MULTI_PARTICLE
			{
				name = Stream1
				modelName = OPT_Reconfig/FX2/NebulaAStream
				transformName = FXNode
				emission = 0.05 0
				emission = 0.4 1
				speed = 0.05 0.5
				speed = 0.4 1
				energy = 1 1 0 0
				energy = 1.5 1 0 0
				energy = 2 1.5
				localScale = 0.75, 0.75, 0.75
			}
			MODEL_MULTI_PARTICLE
			{
				name = Shock1
				modelName = OPT_Reconfig/FX2/s2ShockSteady
				transformName = FXNode
				emission = 0.6 0
				emission = 0.7 1
				speed = 0.6 1.5
				speed = 2 2
				energy = 0.6 0.4
				energy = 1 1
				localScale = 0.75, 0.75, 0.75
			}
			MODEL_MULTI_PARTICLE
			{
				name = Stream2
				modelName = OPT_Reconfig/FX2/NebulaAStream
				transformName = FXNode1
				emission = 0.05 0
				emission = 0.4 1
				speed = 0.05 0.5
				speed = 0.4 1
				energy = 1 1 0 0
				energy = 1.5 1 0 0
				energy = 2 1.5
				localScale = 0.75, 0.75, 0.75
			}
			MODEL_MULTI_PARTICLE
			{
				name = Shock2
				modelName = OPT_Reconfig/FX2/s2ShockSteady
				transformName = FXNode1
				emission = 0.6 0
				emission = 0.7 1
				speed = 0.6 1.5
				speed = 2 2
				energy = 0.6 0.4
				energy = 1 1
				localScale = 0.75, 0.75, 0.75
			}
			MODEL_MULTI_PARTICLE
			{
				name = Stream3
				modelName = OPT_Reconfig/FX2/NebulaAStream
				transformName = FXNode2
				emission = 0.05 0
				emission = 0.4 1
				speed = 0.05 0.5
				speed = 0.4 1
				energy = 1 1 0 0
				energy = 1.5 1 0 0
				energy = 2 1.5
				localScale = 0.75, 0.75, 0.75
			}
			MODEL_MULTI_PARTICLE
			{
				name = Shock3
				modelName = OPT_Reconfig/FX2/s2ShockSteady
				transformName = FXNode2
				emission = 0.6 0
				emission = 0.7 1
				speed = 0.6 1.5
				speed = 2 2
				energy = 0.6 0.4
				energy = 1 1
				localScale = 0.75, 0.75, 0.75
			}
			AUDIO
			{
				name = ramp
				channel = Ship
				clip = OPT_Reconfig/Sounds/airplane_spool_high
				volume = 0.7 0.0
				volume = 1.5 1.0
				volume = 2.0 0.7
				pitch = 1.0 1.0 0 0
				pitch = 2.0 1.5 1 0
				loop = true
			}
			AUDIO
			{
				name = scream
				channel = Ship
				clip = OPT_Reconfig/Sounds/airplane_Cabin
				volume = 0.0 0.0 0 0
				volume = 0.6 0.7 0 0
				volume = 1.0 0.0 0 0
				volume = 1.5 0.0 0 0
				volume = 2.5 0.7 0 0
				pitch = 0.0 0.4 0 0
				pitch = 1.0 1.2 0 0
				pitch = 1.5 1.0 0 0
				loop = true
			}
		}
		running_turbine
		{
			AUDIO
			{
				channel = Ship
				clip = sound_jet_deep
				volume = 0.0 0.0
				volume = 0.05 0.7
				volume = 1.0 1.0
				volume = 1.5 0.5
				volume = 2.0 0.0
				pitch = 0.5 1.0
				pitch = 1.0 1.4
				loop = true
			}
		}
		powersharp
		{
			MODEL_MULTI_PARTICLE
			{
				name = Lamp1
				modelName = OPT_Reconfig/FX2/ARIVacLamp
				transformName = FXNode
				emission = 0.05 0
				emission = 0.1 1
				energy = 0.1 0.3
				energy = 1 1
			}
			MODEL_MULTI_PARTICLE
			{
				name = Flame1
				modelName = OPT_Reconfig/FX2/ARIBlueFlameVac
				transformName = FXNode
				emission = 0.05 0
				emission = 0.5 1
				speed = 0 0.2
				speed = 1 1
			}
			MODEL_MULTI_PARTICLE
			{
				name = Lamp2
				modelName = OPT_Reconfig/FX2/ARIVacLamp
				transformName = FXNode1
				emission = 0.05 0
				emission = 0.1 1
				energy = 0.1 0.3
				energy = 1 1
			}
			MODEL_MULTI_PARTICLE
			{
				name = Flame2
				modelName = OPT_Reconfig/FX2/ARIBlueFlameVac
				transformName = FXNode1
				emission = 0.05 0
				emission = 0.5 1
				speed = 0 0.2
				speed = 1 1
			}
			MODEL_MULTI_PARTICLE
			{
				name = Lamp3
				modelName = OPT_Reconfig/FX2/ARIVacLamp
				transformName = FXNode2
				emission = 0.05 0
				emission = 0.1 1
				energy = 0.1 0.3
				energy = 1 1
			}
			MODEL_MULTI_PARTICLE
			{
				name = Flame3
				modelName = OPT_Reconfig/FX2/ARIBlueFlameVac
				transformName = FXNode2
				emission = 0.05 0
				emission = 0.5 1
				speed = 0 0.2
				speed = 1 1
			}
			// PREFAB_PARTICLE
			// {
				// name = flamethrust2_smoke
				// prefabName = fx_smokeTrail_light
				// transformName = SmokeTransform
				// emission = 0.0 0.0
				// emission = 0.05 0.0
				// emission = 0.075 0.25
				// emission = 1.0 1.25
				// emission = 1.7 2
				// speed = 0.0 0.25
				// speed = 1.0 1.0
			// }
			AUDIO
			{
				name = ramp
				channel = Ship
				clip = OPT_Reconfig/Sounds/airplane_spool_high
				volume = 0.0 0.0
				volume = 0.05 0.4
				volume = 1.0 1.0
				pitch = 0.0 1.3
				pitch = 1.0 1.5
				loop = true
			}
			AUDIO
			{
				name = flame
				channel = Ship
				clip = OPT_Reconfig/Sounds/RCSnoise_9
				volume = 0.0 0.0
				volume = 0.05 0.6
				volume = 1.0 3.0
				pitch = 1.0 1.0
				pitch = 2.0 1.3
				loop = true
				speed = 0.0 2.0
				speed = 1.0 2.0
			}
		}
	}
	MODULE
	{
		name = ModuleAnimateGeneric
		animationName = JExShutter
		startEventGUIName = Close Exhaust Shutters
		endEventGUIName = Open Exhaust Shutters
		actionGUIName = Toggle Exhaust Shutters
		layer = 2
	}
	MODULE
	{
		name = MultiModeEngine
		primaryEngineID = AirBreathing
		secondaryEngineID = ClosedCycle
	}
	MODULE
	{
		name = ModuleEnginesFX
		engineID = AirBreathing
		thrustVectorTransformName = thrustTransform
		exhaustDamage = True
		ignitionThreshold = 0.03
		minThrust = 0
		maxThrust = 300
		heatProduction = 90
		useEngineResponseTime = True
		engineAccelerationSpeed = 0.7
		engineDecelerationSpeed = 0.35
		flameoutEffectName = flameout
		powerEffectName = running_open
		engageEffectName = engage
		disengageEffectName = disengage
		spoolEffectName = running_turbine
		engineSpoolIdle = 0.05
		engineSpoolTime = 1.0
		EngineType = Turbine
		// exhaustDamageMultiplier = 600
		// exhaustDamageMaxRange = 20
		PROPELLANT
		{
			name = LiquidFuel
			ratio = 1
			DrawGauge = True
		}
		PROPELLANT
		{
			name = IntakeAir
			ratio = 9
			ignoreForIsp = True
		}
		atmosphereCurve
		{
			key = 0 3000
		}
		atmChangeFlow = True
		useVelCurve = True
		useAtmCurve = True
		velCurve
		{
			key = 0 0.8 0.7536919 0.896623
			key = 0.8 0.62 -2 -2
			key = 1 0
		}
		atmCurve
		{
			key = 0 0
			key = 1 1
			key = 10 3 0 0
		}
	}
	MODULE
	{
		name = ModuleEnginesFX
		engineID = ClosedCycle
		thrustVectorTransformName = thrustTransform
		exhaustDamage = True
		ignitionThreshold = 0.03
		minThrust = 0
		maxThrust = 300
		heatProduction = 90
		powerEffectName = powersharp
		engineSpoolIdle = 0.05
		engineSpoolTime = 1.0
		EngineType = LiquidFuel
		// exhaustDamageMultiplier = 600
		// exhaustDamageMaxRange = 20
		PROPELLANT
		{
			name = LiquidFuel
			ratio = 0.45
			DrawGauge = True
		}
		PROPELLANT
		{
			name = Oxidizer
			ratio = 0.55
			ignoreForIsp = True
		}
		PROPELLANT
		{
			name = ElectricCharge
			ratio = 2.5
			DrawGauge = True
		}
        atmosphereCurve
        {
			key = 0.001 380
			key = 1 320
			key = 5 160
			key = 20 0.01 0 0
        }
	}
	MODULE
	{
		name = ModuleAlternator
		engineName = AirBreathing
		RESOURCE
		{
			name = ElectricCharge
			rate = 5.0
		}
	}
	MODULE
	{
		name = ModuleSurfaceFX
		thrustProviderModuleIndex = 0
		fxMax = 0.6
		maxDistance = 25
		falloff = 2
		thrustTransformName = thrustTransform
	}
	MODULE
	{
		name = ModuleGimbal
		gimbalTransformName = thrustTransform
		gimbalResponseSpeed = 10
		useGimbalResponseSpeed = true
		gimbalRangeXP = 3
		gimbalRangeXN = 3
		gimbalRangeYP = 0
		gimbalRangeYN = 0
		gimbalRangeZP = 0
		gimbalRangeZN = 0
	}
	MODULE
	{
		name = FXModuleThrottleEffects
		fxModuleNames = throttleColor
		responseSpeed = 1.0
		dependOnEngineState = True
		dependOnThrottle = True
		preferMultiMode = True
	}
	MODULE
	{
		name = FXModuleThrottleEffects
		fxModuleNames = heatColor
		responseSpeed = 1.0
		dependOnEngineState = True
		dependOnThrottle = True
		preferMultiMode = True
	}
	MODULE
	{
		name = ModuleColorChanger
		moduleID = throttleColor
		animRate = 1
		shaderProperty = _TintColor
		includedRenderer = J_Engine_Throttle
		toggleInEditor = False
		toggleInFlight = False
		redCurve
		{
			key = 0 0
			key = 1 0.5
		}
		greenCurve
		{
			key = 0 0
			key = 0.5 1
		}
		blueCurve
		{
			key = 0 0
			key = 0.5 1
		}
		alphaCurve
		{
			key = 0 0
			key = 1 1
		}
	}
	MODULE
	{
		name = ModuleColorChanger
		moduleID = heatColor
		animRate = 0.025
		shaderProperty = _EmissiveColor
		excludedRenderer = J_Engine_Throttle
		toggleInEditor = False
		toggleInFlight = False
		redCurve
		{
			key = 0 0 1 1
			key = 1 1 1 1
		}
		greenCurve
		{
			key = 0 0 1 1
			key = 1 1 1 1
		}
		blueCurve
		{
			key = 0 0 1 1
			key = 1 1 1 1
		}
		alphaCurve
		{
			key = 0 0 1 1
			key = 1 1 1 1
		}
	}
	MODULE
	{
		name = ModuleResourceIntake
		resourceName = IntakeAir
		checkForOxygen = True
		area = 0.008
		intakeSpeed = 30
		intakeTransformName = intakeTransform
		machCurve
		{
			key = 0.3 1 0 0
			key = 1 0.01 0 0
		}
	}
	RESOURCE
	{
		name = IntakeAir
		amount = 10
		maxAmount = 10
	}
	MODULE
	{
		name = ModuleLiftingSurface
		useInternalDragModel = False
		deflectionLiftCoeff = 0.5
		dragAtMaxAoA = 0.1
		dragAtMinAoA = 0.05
	}
}

+PART[opt_vtol_wrapj1]
{
	@name = opt_vtol_wrapk1
	@title = OPT-E FVT-K
	@MODEL
	{
		@model = OPT_Legacy/Parts/Engines/VTOL/K
	}
	@node_attach[1, ] = 4,

	@mass = 6
	@bulkheadProfiles = k,srf
	@MODULE[ModuleAnimateGeneric]
	{
		@animationName = KExShutter
	}
	@MODULE[ModuleEnginesFX],*
	{
		@maxThrust = 500
	}
	@MODULE[ModuleColorChanger],*
	{
		@includedRenderer = K_Engine_Throttle
		@excludedRenderer = K_Engine_Throttle
	}
	@MODULE[ModuleResourceIntake]
	{
		@area = 0.012
	}
	@MODULE[ModuleAlternator]
	{
		@RESOURCE[ElectricCharge]
		{
			@rate *= 1.5
		}
	}
}

+PART[opt_vtol_wrapj1]
{
	@name = opt_vtol_wrapl1
	@title = OPT-E FVT-L (Humpback)
	@MODEL
	{
		@model = OPT_Legacy/Parts/Engines/VTOL/L
	}
	@node_attach[1, ] = 4.151,

	@mass = 6
	@bulkheadProfiles = humpback,srf
	@MODULE[ModuleAnimateGeneric]
	{
		@animationName = LExShutter
	}
	@MODULE[ModuleEnginesFX],*
	{
		@maxThrust = 500
	}
	@MODULE[ModuleColorChanger],*
	{
		@includedRenderer = L_Engine_Throttle
		@excludedRenderer = L_Engine_Throttle
	}
	@MODULE[ModuleResourceIntake]
	{
		@area = 0.012
	}
	@MODULE[ModuleAlternator]
	{
		@RESOURCE[ElectricCharge]
		{
			@rate *= 1.5
		}
	}
}

@PART[opt_vtol_j]
{
	@EFFECTS
	{
		@powersharp
		{
			!MODEL_MULTI_PARTICLE[Lamp3] {}
			!MODEL_MULTI_PARTICLE[Flame3] {}
		}
		@power_open
		{
			!MODEL_MULTI_PARTICLE[Stream3] {}
			!MODEL_MULTI_PARTICLE[Shock3] {}
		}
	}
}